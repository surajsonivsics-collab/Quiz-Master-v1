<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Quiz Master</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- ✅ Bootstrap CSS (Updated) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- ✅ Bootstrap Icons (Updated) -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />

    <!-- ✅ Custom CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/styles.css') }}"
    />

    <!-- ✅ PWA Manifest -->
    <link
      rel="manifest"
      href="{{ url_for('static', filename='manifest.json') }}"
    />
    <meta name="theme-color" content="#4e54c8" />

    <!-- ✅ iOS support -->
    <link
      rel="apple-touch-icon"
      href="{{ url_for('static', filename='icons/icon-192.png') }}"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
  </head>

  <body>
    <!-- ✅ Navbar block -->
    {% block navbar %}
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
      <a class="navbar-brand" href="{{ url_for('welcome') }}">Quiz Master</a>
      <div class="ms-auto d-flex align-items-center">
        {% if current_user.is_authenticated %}
        <span class="text-light me-3">Hi, {{ current_user.full_name }}</span>

        {% if current_user.role == 'admin' %}
        <a
          class="btn btn-outline-info me-2"
          href="{{ url_for('admin_dashboard') }}"
        >
          Admin Dashboard
        </a>
        {% elif current_user.role == 'user' %}
        <a
          class="btn btn-outline-info me-2"
          href="{{ url_for('user_dashboard') }}"
        >
          User Dashboard
        </a>
        {% endif %}

        <a class="btn btn-outline-light" href="{{ url_for('logout') }}">
          Logout
        </a>
        {% else %}
        <a class="btn btn-outline-light me-2" href="{{ url_for('login') }}">
          Login
        </a>
        <a class="btn btn-primary" href="{{ url_for('register') }}">
          Register
        </a>
        {% endif %}
      </div>
    </nav>
    {% endblock %}
    <!-- ✅ End Navbar block -->

    <!-- ✅ Page Content -->
    <div class="content">
      <div class="container-fluid mt-4">
        {% with messages = get_flashed_messages(with_categories=true) %} {% for
        category, msg in messages %}
        <div class="alert alert-{{ category }}">{{ msg }}</div>
        {% endfor %} {% endwith %} {% block content %}{% endblock %}
      </div>
    </div>

    <!-- ✅ Bootstrap JS Bundle (Updated) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- ✅ Register Service Worker -->
    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("{{ url_for('static', filename='sw.js') }}")
          .then((reg) => console.log("✅ Service Worker registered:", reg))
          .catch((err) => console.log("❌ Service Worker error:", err));
      }
    </script>

    <!-- ✅ Page Transition Animation -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const body = document.body;
        body.classList.add("page-enter");

        requestAnimationFrame(() => {
          body.classList.add("page-enter-active");
        });

        // Smooth exit on link clicks
        document.querySelectorAll("a").forEach((link) => {
          link.addEventListener("click", function (e) {
            if (
              link.getAttribute("href").startsWith("#") ||
              link.getAttribute("target") === "_blank"
            )
              return;

            e.preventDefault();
            body.classList.remove("page-enter-active");
            body.classList.add("page-exit-active");

            setTimeout(() => {
              window.location.href = link.href;
            }, 600);
          });
        });
      });
    </script>
  </body>
</html>
