{% extends "base.html" %} {% block content %}
<h2>Manage Subject</h2>

<!-- Subject Header with Edit/Delete -->
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h4 class="mb-0">{{ subject.name }}</h4>
    <small class="text-muted">{{ subject.description }}</small>
  </div>
  <div>
    <a
      href="{{ url_for('edit_subject', subject_id=subject.id) }}"
      class="btn btn-warning btn-sm"
    >
      Edit Subject
    </a>
    <!-- ✅ Delete Subject via POST -->
    <form
      action="{{ url_for('delete_subject', subject_id=subject.id) }}"
      method="POST"
      style="display: inline"
    >
      <button
        type="submit"
        class="btn btn-danger btn-sm"
        onclick="return confirm('Are you sure you want to delete this subject? This will also delete its chapters and quizzes.')"
      >
        Delete Subject
      </button>
    </form>
  </div>
</div>

<!-- Add Chapter & Back Button -->
<div class="mb-3">
  <a
    href="{{ url_for('add_chapter', subject_id=subject.id) }}"
    class="btn btn-primary"
  >
    + Add Chapter
  </a>
  <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">
    ⬅ Back to Dashboard
  </a>
</div>

<!-- Chapters Accordion -->
<div class="accordion" id="chaptersAccordion">
  {% for chapter in chapters %}
  <div class="accordion-item">
    <!-- Chapter Header -->
    <h2
      class="accordion-header d-flex align-items-center justify-content-between"
      id="heading{{ chapter.id }}"
    >
      <button
        class="accordion-button collapsed flex-grow-1 text-start"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#collapse{{ chapter.id }}"
        aria-expanded="false"
        aria-controls="collapse{{ chapter.id }}"
      >
        {{ chapter.name }}
        <small class="text-muted ms-2">{{ chapter.description }}</small>
      </button>
      <div class="ms-2">
        <a
          href="{{ url_for('edit_chapter', chapter_id=chapter.id) }}"
          class="btn btn-warning btn-sm"
        >
          Edit
        </a>
        <!-- ✅ Delete Chapter via POST -->
        <form
          action="{{ url_for('delete_chapter', chapter_id=chapter.id) }}"
          method="POST"
          style="display: inline"
        >
          <button
            type="submit"
            class="btn btn-danger btn-sm"
            onclick="return confirm('Are you sure you want to delete this chapter? This will also delete its quizzes.')"
          >
            Delete
          </button>
        </form>
      </div>
    </h2>

    <!-- Quizzes inside Chapter -->
    <div
      id="collapse{{ chapter.id }}"
      class="accordion-collapse collapse"
      aria-labelledby="heading{{ chapter.id }}"
      data-bs-parent="#chaptersAccordion"
    >
      <div class="accordion-body">
        <h6>Quizzes</h6>
        <ul class="list-group">
          {% for quiz in chapter.quizzes %}
          <li
            class="list-group-item d-flex justify-content-between align-items-center"
          >
            <div>
              <strong>{{ quiz.name }}</strong><br />
              {% if quiz.date_of_quiz or quiz.time_duration %}
              <small class="text-muted">
                {{ quiz.date_of_quiz }}{% if quiz.date_of_quiz and
                quiz.time_duration %} | {% endif %} Duration: {{
                quiz.time_duration }} </small
              ><br />
              {% endif %} {% if quiz.remarks %}
              <em>{{ quiz.remarks }}</em>
              {% endif %}
            </div>
            <div class="btn-group">
              <a
                href="{{ url_for('manage_questions', quiz_id=quiz.id) }}"
                class="btn btn-info btn-sm"
              >
                View Questions
              </a>
              <a
                href="{{ url_for('add_question', quiz_id=quiz.id) }}"
                class="btn btn-success btn-sm"
              >
                Add Question
              </a>
              <a
                href="{{ url_for('edit_quiz', quiz_id=quiz.id) }}"
                class="btn btn-warning btn-sm"
              >
                Edit
              </a>
              <!-- ✅ Delete Quiz via POST -->
              <form
                action="{{ url_for('delete_quiz', quiz_id=quiz.id) }}"
                method="POST"
                style="display: inline"
              >
                <button
                  type="submit"
                  class="btn btn-danger btn-sm"
                  onclick="return confirm('Are you sure you want to delete this quiz? All its questions will also be removed.')"
                >
                  Delete
                </button>
              </form>
            </div>
          </li>
          {% else %}
          <li class="list-group-item"><em>No quizzes yet.</em></li>
          {% endfor %}
        </ul>

        <!-- Add Quiz Button -->
        <a
          href="{{ url_for('add_quiz', chapter_id=chapter.id) }}"
          class="btn btn-primary btn-sm mt-2"
        >
          + Add Quiz
        </a>
      </div>
    </div>
  </div>
  {% else %}
  <p><em>No chapters yet</em></p>
  {% endfor %}
</div>
{% endblock %}
