{% extends "base.html" %} {% block content %}
<div class="container mt-4">
  <h2>Quiz {{ quiz.id }} - {{ quiz.name }}</h2>

  {% if questions and questions|length > 0 %}
  <div class="alert alert-warning">
    ‚è≥ Time Remaining: <span id="timer"></span>
  </div>

  <form method="POST" id="quizForm">
    {% if csrf_token %}
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
    {% endif %} {% for q in questions %}
    <div class="card mb-3">
      <div class="card-body">
        <p><b>Q{{ loop.index }}: {{ q["statement"] }}</b></p>

        {% for i in range(1, 5) %}
        <div class="form-check">
          <input
            class="form-check-input"
            type="radio"
            name="q{{ q['id'] }}"
            value="{{ i }}"
            id="q{{ q['id'] }}_opt{{ i }}"
            required
          />
          <label class="form-check-label" for="q{{ q['id'] }}_opt{{ i }}">
            {{ q["option" ~ i] }}
          </label>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endfor %}

    <button type="submit" class="btn btn-primary">Submit Quiz</button>
  </form>

  <script>
    // Timer (duration passed from Flask in minutes)
    let timeLeft = {{ duration|int }} * 60; // seconds
    const timerEl = document.getElementById("timer");
    const quizForm = document.getElementById("quizForm");

    function updateTimer() {
      let minutes = Math.floor(timeLeft / 60);
      let seconds = timeLeft % 60;
      timerEl.textContent = `${minutes}:${seconds.toString().padStart(2, "0")}`;

      if (timeLeft <= 0) {
        clearInterval(timer);
        alert("‚è∞ Time is up! Submitting your quiz...");
        quizForm.submit();
      }

      timeLeft--;
    }

    updateTimer();
    const timer = setInterval(updateTimer, 1000);
  </script>
  {% else %}
  <div class="alert alert-info">üì≠ No questions available in this quiz.</div>
  {% endif %}
</div>
{% endblock %}
